<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light" />
  <title>숫자 순서 터치 (Number Tap Rush)</title>
  <style>
    :root{
      --bg0:#0b1020;
      --bg1:#111a36;
      --card:rgba(255,255,255,.08);
      --card2:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --line:rgba(255,255,255,.14);
      --good:#47e6b1;
      --bad:#ff5a7a;
      --warn:#ffd36a;
      --accent:#7aa7ff;
      --shadow: 0 24px 60px rgba(0,0,0,.35);
      --r: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "DNF Bit Bit v2", "DungGeunMo", "Pretendard", "Apple SD Gothic Neo", "Malgun Gothic", system-ui, sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(122,167,255,.22), transparent 55%),
        radial-gradient(900px 650px at 80% 20%, rgba(71,230,177,.18), transparent 60%),
        radial-gradient(900px 650px at 60% 95%, rgba(255,90,122,.18), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--text);
      overflow-x:hidden;
    }

    .noise{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.07;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 14px 56px;
    }

    .app{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
    }

    @media (max-width: 920px){
      .app{grid-template-columns: 1fr; }
    }

    .panel{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .head{
      padding:18px 18px 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--line);
      background:
        radial-gradient(900px 300px at 10% 0%, rgba(122,167,255,.20), transparent 60%),
        radial-gradient(700px 260px at 90% 0%, rgba(71,230,177,.16), transparent 55%);
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .title h1{
      margin:0;
      font-size: 22px;
      letter-spacing: -.2px;
      font-weight: 800;
    }
    .title .sub{
      color:var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .badge{
      font-size:12px;
      color:rgba(255,255,255,.86);
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      padding:7px 10px;
      border-radius: 999px;
      white-space:nowrap;
      user-select:none;
    }

    .body{
      padding:14px;
    }

    .gridWrap{
      padding: 14px;
    }

    .hud{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      padding: 14px 14px 0;
    }

    .hudLeft{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .stat{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius: 14px;
      padding: 10px 12px;
      min-width: 150px;
    }
    .stat .k{
      color: var(--muted);
      font-size: 12px;
    }
    .stat .v{
      margin-top: 2px;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: .2px;
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .btn{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.07));
      color:var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      font-weight: 800;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .12s ease, background .12s ease;
    }
    .btn:hover{ filter: brightness(1.06); }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.primary{
      border-color: rgba(122,167,255,.55);
      background: linear-gradient(180deg, rgba(122,167,255,.35), rgba(122,167,255,.16));
    }
    .btn.danger{
      border-color: rgba(255,90,122,.55);
      background: linear-gradient(180deg, rgba(255,90,122,.30), rgba(255,90,122,.14));
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .field{
      flex: 1 1 220px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding: 10px 12px;
    }
    .field label{
      display:block;
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 6px;
    }
    select, input[type="checkbox"]{
      accent-color: var(--accent);
    }
    select{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
      font-weight: 800;
    }
    .checkline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 10px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      border-radius: 12px;
      font-weight: 800;
    }
    .checkline span{ color: var(--muted); font-weight: 700; font-size: 12px; }

    .grid{
      display:grid;
      grid-template-columns: repeat(var(--n), minmax(0, 1fr));
      gap:10px;
      padding:10px;
      border-radius: var(--r);
      border:1px solid var(--line);
      background: rgba(0,0,0,.15);
      position:relative;
      overflow:hidden;
    }
    .cell{
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background:
        radial-gradient(160px 100px at 30% 20%, rgba(255,255,255,.16), transparent 50%),
        linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
      box-shadow: inset 0 1px 0 rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      font-weight: 900;
      font-size: clamp(16px, 3.2vw, 24px);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .12s ease, background .12s ease, opacity .12s ease;
      touch-action: manipulation;
    }
    .cell:hover{ filter: brightness(1.05); }
    .cell:active{ transform: translateY(1px) scale(.99); }
    .cell.done{
      opacity:.26;
      filter: saturate(.4);
      cursor: default;
    }
    .cell.hint{
      outline: 2px solid rgba(122,167,255,.55);
      outline-offset: 2px;
    }
    .cell.bad{
      background:
        radial-gradient(180px 120px at 50% 20%, rgba(255,90,122,.32), transparent 60%),
        linear-gradient(180deg, rgba(255,90,122,.20), rgba(255,255,255,.05));
      border-color: rgba(255,90,122,.35);
    }

    .toast{
      position:absolute;
      left:12px;
      right:12px;
      top:12px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.35);
      color: rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
      display:none;
    }
    .toast.show{ display:block; animation: pop .18s ease; }
    @keyframes pop{ from{ transform: translateY(-6px); opacity:.6 } to{ transform: translateY(0); opacity:1 } }

    .rightBody{
      padding: 14px 18px 18px;
    }
    .sectionTitle{
      margin: 14px 0 8px;
      font-size: 13px;
      letter-spacing: .2px;
      color: rgba(255,255,255,.84);
      text-transform: uppercase;
    }
    .howto{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding: 12px 12px;
      color: rgba(255,255,255,.86);
      line-height: 1.5;
      font-size: 13px;
    }
    .howto b{ color: rgba(255,255,255,.95); }

    .miniRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .pill{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      color: rgba(255,255,255,.84);
      user-select:none;
    }
    .pill.good{ border-color: rgba(71,230,177,.35); }
    .pill.bad{ border-color: rgba(255,90,122,.35); }
    .pill.warn{ border-color: rgba(255,211,106,.35); }
    .pill.acc{ border-color: rgba(122,167,255,.35); }

    .footerNote{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }

    .fadeIn{
      animation: enter .35s ease both;
    }
    @keyframes enter{
      from{ transform: translateY(8px); opacity: 0 }
      to{ transform: translateY(0); opacity: 1 }
    }
  </style>
</head>
<body>
  <div class="noise"></div>
  <div class="wrap">
    <div class="app">
      <div class="panel fadeIn">
        <div class="head">
          <div class="title">
            <h1>숫자 순서 터치</h1>
            <div class="sub">1부터 끝까지, <b>틀리지 않고</b> 최대한 빠르게. 단순하지만 중독성 있는 손가락 워밍업.</div>
          </div>
          <div class="badge" id="badge">대기중</div>
        </div>

        <div class="hud">
          <div class="hudLeft">
            <div class="stat">
              <div class="k">다음 숫자</div>
              <div class="v" id="nextNum">1</div>
            </div>
            <div class="stat">
              <div class="k">시간</div>
              <div class="v" id="time">0.00s</div>
            </div>
            <div class="stat">
              <div class="k">실수</div>
              <div class="v" id="misses">0</div>
            </div>
          </div>
          <div class="controls">
            <button class="btn" id="btnShuffle" type="button">섞기</button>
            <button class="btn primary" id="btnStart" type="button">시작</button>
            <button class="btn danger" id="btnReset" type="button">리셋</button>
          </div>
        </div>

        <div class="body">
          <div class="row" aria-label="설정">
            <div class="field">
              <label for="size">그리드 크기</label>
              <select id="size">
                <option value="3">3 x 3 (9칸)</option>
                <option value="4" selected>4 x 4 (16칸)</option>
                <option value="5">5 x 5 (25칸)</option>
                <option value="6">6 x 6 (36칸)</option>
              </select>
            </div>
            <div class="field">
              <label>옵션</label>
              <div class="checkline">
                <div>
                  숫자 숨기기
                  <div><span>시작 후 1.2초 지나면 전체 숫자를 흐리게</span></div>
                </div>
                <input id="hideNumbers" type="checkbox" />
              </div>
            </div>
            <div class="field">
              <label>도움</label>
              <div class="checkline">
                <div>
                  다음 숫자 강조
                  <div><span>다음 숫자 칸에 테두리 표시</span></div>
                </div>
                <input id="hint" type="checkbox" checked />
              </div>
            </div>
          </div>
        </div>

        <div class="gridWrap">
          <div class="grid" id="grid" style="--n:4" aria-label="게임 그리드">
            <div class="toast" id="toast"></div>
          </div>
        </div>
      </div>

      <div class="panel fadeIn">
        <div class="head">
          <div class="title">
            <h1>기록 / 방법</h1>
            <div class="sub">기록은 이 기기 브라우저에 자동 저장됩니다(로컬 저장).</div>
          </div>
          <div class="badge" id="bestBadge">BEST: -</div>
        </div>
        <div class="rightBody">
          <div class="sectionTitle">게임 방법</div>
          <div class="howto" id="howto">
            <b>목표:</b> 1부터 마지막 숫자까지 순서대로 누르며 시간 단축.<br/>
            <b>시작:</b> <b>시작</b> 버튼을 누르고 <b>1</b>을 누르는 순간 타이머가 시작됩니다.<br/>
            <b>실수:</b> 다음 숫자가 아닌 칸을 누르면 <b>실수 +1</b> (시간은 계속 흐름).<br/>
            <b>끝:</b> 마지막 숫자를 누르면 종료. 기록이 자동으로 저장됩니다.
          </div>

          <div class="sectionTitle">팁</div>
          <div class="miniRow">
            <div class="pill acc">시선은 2-3칸 앞</div>
            <div class="pill warn">손가락은 화면 아래 고정</div>
            <div class="pill good">작게, 빠르게 탭</div>
            <div class="pill bad">실수 줄이기 = 기록 단축</div>
          </div>

          <div class="sectionTitle">현재 설정</div>
          <div class="howto" id="settingsText"></div>

          <div class="footerNote">
            오프라인 동작. 모바일/PC 모두 지원. URL 파라미터로 바로 설정할 수도 있습니다:
            <code style="color:rgba(255,255,255,.78)">?n=5&amp;hide=1&amp;hint=1</code>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      const $ = (sel) => document.querySelector(sel);
      const gridEl = $("#grid");
      const toastEl = $("#toast");
      const badgeEl = $("#badge");
      const bestBadgeEl = $("#bestBadge");
      const nextEl = $("#nextNum");
      const timeEl = $("#time");
      const missesEl = $("#misses");
      const sizeEl = $("#size");
      const hideEl = $("#hideNumbers");
      const hintEl = $("#hint");
      const settingsTextEl = $("#settingsText");
      const btnShuffle = $("#btnShuffle");
      const btnStart = $("#btnStart");
      const btnReset = $("#btnReset");

      const qs = new URLSearchParams(location.search);
      const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
      const nowMs = () => performance.now();

      let n = 4;
      let total = n*n;
      let nums = [];
      let next = 1;
      let misses = 0;
      let started = false;
      let startAt = 0;
      let raf = 0;
      let hideTimer = 0;
      let hideNumbers = false;
      let hint = true;

      function shuffle(arr){
        // Fisher-Yates
        for (let i = arr.length - 1; i > 0; i--){
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function bestKey(){
        return `number_tap_rush.best.n${n}.hide${hideNumbers?1:0}`;
      }

      function fmtTime(ms){
        return (ms/1000).toFixed(2) + "s";
      }

      function showToast(text, kind){
        toastEl.textContent = text;
        toastEl.style.borderColor =
          kind === "good" ? "rgba(71,230,177,.35)" :
          kind === "bad" ? "rgba(255,90,122,.35)" :
          kind === "warn" ? "rgba(255,211,106,.35)" :
          "rgba(255,255,255,.18)";
        toastEl.classList.add("show");
        clearTimeout(showToast._t);
        showToast._t = setTimeout(() => toastEl.classList.remove("show"), 1200);
      }

      function setBadge(text, kind){
        badgeEl.textContent = text;
        badgeEl.style.borderColor =
          kind === "good" ? "rgba(71,230,177,.42)" :
          kind === "bad" ? "rgba(255,90,122,.42)" :
          kind === "warn" ? "rgba(255,211,106,.42)" :
          "rgba(255,255,255,.22)";
      }

      function readBest(){
        const raw = localStorage.getItem(bestKey());
        const v = raw ? Number(raw) : 0;
        if (!Number.isFinite(v) || v <= 0) return 0;
        return v;
      }

      function writeBest(ms){
        try { localStorage.setItem(bestKey(), String(ms)); } catch(_e) {}
      }

      function updateBestUI(){
        const best = readBest();
        bestBadgeEl.textContent = best ? `BEST: ${fmtTime(best)}` : "BEST: -";
      }

      function updateSettingsText(){
        const lines = [
          `그리드: ${n} x ${n} (총 ${total}칸)`,
          `숫자 숨기기: ${hideNumbers ? "ON" : "OFF"}`,
          `다음 숫자 강조: ${hint ? "ON" : "OFF"}`
        ];
        settingsTextEl.textContent = lines.join("\n");
      }

      function setHUD(){
        nextEl.textContent = String(next);
        missesEl.textContent = String(misses);
      }

      function stopTimer(){
        started = false;
        cancelAnimationFrame(raf);
        raf = 0;
      }

      function tick(){
        if (!started) return;
        timeEl.textContent = fmtTime(nowMs() - startAt);
        raf = requestAnimationFrame(tick);
      }

      function makeNums(){
        total = n*n;
        nums = Array.from({length: total}, (_, i) => i + 1);
        shuffle(nums);
      }

      function clearGrid(){
        const old = gridEl.querySelectorAll(".cell");
        old.forEach(el => el.remove());
      }

      function applyHint(){
        if (!hint) {
          gridEl.querySelectorAll(".cell").forEach(el => el.classList.remove("hint"));
          return;
        }
        gridEl.querySelectorAll(".cell").forEach(el => {
          const v = Number(el.dataset.v);
          el.classList.toggle("hint", v === next && !el.classList.contains("done"));
        });
      }

      function applyHideNumbers(){
        gridEl.querySelectorAll(".cell").forEach(el => {
          if (el.classList.contains("done")) return;
          const label = el.querySelector("span");
          if (!label) return;
          label.style.opacity = hideNumbers && started ? ".14" : "1";
        });
      }

      function renderGrid(){
        gridEl.style.setProperty("--n", String(n));
        clearGrid();

        const frag = document.createDocumentFragment();
        for (const v of nums){
          const btn = document.createElement("button");
          btn.className = "cell";
          btn.type = "button";
          btn.dataset.v = String(v);
          btn.setAttribute("aria-label", `숫자 ${v}`);
          const label = document.createElement("span");
          label.textContent = String(v);
          btn.appendChild(label);

          btn.addEventListener("click", () => onTap(btn));
          frag.appendChild(btn);
        }
        gridEl.appendChild(frag);
        gridEl.appendChild(toastEl); // keep toast on top
        applyHint();
        applyHideNumbers();
      }

      function resetRunUI(){
        next = 1;
        misses = 0;
        timeEl.textContent = "0.00s";
        setHUD();
        setBadge("대기중", "warn");
        stopTimer();
        gridEl.querySelectorAll(".cell").forEach(el => {
          el.classList.remove("done", "bad");
          const label = el.querySelector("span");
          if (label) label.style.opacity = "1";
        });
        applyHint();
        applyHideNumbers();
      }

      function startRound(){
        resetRunUI();
        showToast("준비. 1부터 시작!", "warn");
        setBadge("준비됨", "warn");
      }

      function finishRound(){
        const ms = nowMs() - startAt;
        stopTimer();
        setBadge("완료!", "good");
        showToast(`완료! ${fmtTime(ms)} (실수 ${misses})`, "good");

        const best = readBest();
        if (!best || ms < best){
          writeBest(ms);
          updateBestUI();
          showToast(`신기록! ${fmtTime(ms)}`, "good");
        }
      }

      function onTap(el){
        const v = Number(el.dataset.v);
        if (!Number.isFinite(v)) return;
        if (el.classList.contains("done")) return;

        if (!started){
          if (v !== 1){
            misses++;
            setHUD();
            el.classList.add("bad");
            setTimeout(() => el.classList.remove("bad"), 150);
            showToast("시작은 1부터!", "bad");
            return;
          }
          started = true;
          startAt = nowMs();
          setBadge("진행중", "acc");
          tick();
          clearTimeout(hideTimer);
          hideTimer = setTimeout(() => applyHideNumbers(), 1200);
        }

        if (v !== next){
          misses++;
          setHUD();
          el.classList.add("bad");
          setTimeout(() => el.classList.remove("bad"), 150);
          showToast(`다음은 ${next}!`, "bad");
          return;
        }

        el.classList.add("done");
        // correct tap: show this one even in hide mode
        const label = el.querySelector("span");
        if (label) label.style.opacity = "1";

        next++;
        setHUD();
        applyHint();
        applyHideNumbers();

        if (next > total){
          finishRound();
        }
      }

      function applyFromControls(){
        n = clamp(Number(sizeEl.value || 4), 3, 6);
        hideNumbers = !!hideEl.checked;
        hint = !!hintEl.checked;
        updateSettingsText();
        makeNums();
        renderGrid();
        resetRunUI();
        updateBestUI();
      }

      function parseUrl(){
        if (qs.has("n")){
          const v = clamp(Number(qs.get("n") || 4), 3, 6);
          sizeEl.value = String(v);
        }
        hideEl.checked = qs.get("hide") === "1";
        hintEl.checked = qs.get("hint") !== "0";
      }

      btnShuffle.addEventListener("click", () => {
        stopTimer();
        makeNums();
        renderGrid();
        resetRunUI();
        showToast("섞었음. 다시 1부터!", "warn");
      });

      btnStart.addEventListener("click", () => {
        stopTimer();
        makeNums();
        renderGrid();
        startRound();
      });

      btnReset.addEventListener("click", () => {
        stopTimer();
        resetRunUI();
        showToast("리셋 완료", "warn");
      });

      sizeEl.addEventListener("change", applyFromControls);
      hideEl.addEventListener("change", applyFromControls);
      hintEl.addEventListener("change", applyFromControls);

      // init
      parseUrl();
      applyFromControls();
      startRound();
    })();
  </script>
</body>
</html>

