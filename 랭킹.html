<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>ë­í‚¹</title>
    
    <link rel="manifest" href="manifest.json">
    <link href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff" as="font" type="font/woff" crossorigin>
    <style>
        /* ëŒ€ê¸°ì‹¤.htmlì˜ ëª¨ë“  <style> ë‚´ìš©ì„ ì—¬ê¸°ì— ë³µì‚¬í•©ë‹ˆë‹¤. */
        :root {
            --bg-color: #FFFBEB;
            --primary-color: #FF6B6B;
            --secondary-color: #4ECDC4;
            --accent-color: #FFD93D;
            --text-color-dark: #574141;
            --text-color-light: #ffffff;
            --danger-color: #F76363;
            --panel-bg: #FFFFFF;
            --panel-border: #F0EAD2;
            --panel-shadow: #E4DCCF;
            --font-main: 'GmarketSans', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            width: 100%; height: 100%; overflow: hidden;
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color-dark);
            -webkit-user-select: none; user-select: none;
            touch-action: manipulation;
        }
        .view {
            width: 100%; height: 100%; 
            display: flex; flex-direction: column;
        }
        .spinner {
            border: 5px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            border-top: 5px solid var(--accent-color);
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* ì•„ì¼€ì´ë“œ ìŠ¤íƒ€ì¼ ë²„íŠ¼ (ëŒ€ê¸°ì‹¤.htmlê³¼ ë™ì¼) */
        .menu-btn {
            width: 100%; padding: 16px; font-size: 1.25em; font-weight: 900;
            font-family: var(--font-main);
            border-radius: 16px; border: none; cursor: pointer;
            transition: all 0.1s ease-out;
            border-bottom: 5px solid;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.1);
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .menu-btn:active { transform: translateY(3px); border-bottom-width: 2px; }
        .menu-btn.primary { background-color: var(--primary-color); color: var(--text-color-light); border-bottom-color: #C04A4A; }
        .menu-btn.secondary { background-color: var(--secondary-color); color: var(--text-color-light); border-bottom-color: #379A93; }
        .menu-btn.accent { background-color: var(--accent-color); color: var(--text-color-dark); border-bottom-color: #D1B030; text-shadow: none; }
        .menu-btn.light { background-color: #F8F9FA; color: var(--text-color-dark); border-bottom-color: #BDBDBD; }
        .menu-btn:disabled { background-color: #BDBDBD !important; color: #757575 !important; border-bottom-color: #8D8D8D !important; cursor: not-allowed; transform: none; }

        /* í˜ì´ì§€ í—¤ë” (ëŒ€ê¸°ì‹¤.htmlê³¼ ì•½ê°„ ë‹¤ë¦„) */
        .page-header {
            width: 100%; padding: 10px 12px; flex-shrink: 0;
            background: #FFFAE0;
            border-bottom: 3px solid var(--panel-border);
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            gap: 8px;
        }
        .page-header h1 {
            font-size: 1.3em;
            color: var(--text-color-dark);
            margin: 0;
            flex-grow: 1;
            text-align: center;
        }
        .back-btn {
            background: none; border: none; color: var(--text-color-dark);
            font-size: 2.0em; cursor: pointer; padding: 0 10px;
            text-decoration: none;
            font-weight: 700;
            line-height: 1;
        }

        /* ------------------------- */
        /* == ë­í‚¹ ì»¨í…ì¸  (í†µí•©ëŒ€ê¸°ì‹¤.htmlì—ì„œ ë³µì‚¬) == */
        /* ------------------------- */
        /* [ì œê±°] #ranking-tabs ë° .tab-btn ìŠ¤íƒ€ì¼ ì œê±° */
        
        #ranking-content { flex-grow: 1; overflow-y: auto; padding: 0 15px 15px; }
        .ranking-list { display: flex; flex-direction: column; gap: 12px; }
        
        .rank-item {
            display: flex; align-items: center;
            background-color: #fff;
            border-radius: 16px;
            padding: 12px;
            border: 2px solid var(--panel-border);
        }
        .rank-item.is-me { /* [ì¶”ê°€] 'ë‚˜' ê°•ì¡° ìŠ¤íƒ€ì¼ */
            background-color: #FFF8E1;
            border-color: var(--accent-color);
        }
        .rank-item:nth-child(1) { background-color: #FFF8E1; border-color: #FFD93D; }
        .rank-item:nth-child(2) { background-color: #F8F9FA; border-color: #E0E0E0; }
        .rank-item:nth-child(3) { background-color: #FFF3E0; border-color: #FFCC80; }

        .rank-col-rank {
            font-size: 1.5em; font-weight: 900;
            color: #888; width: 40px; text-align: center;
            flex-shrink: 0;
        }
        .rank-item:nth-child(1) .rank-col-rank { color: #FFA000; }
        .rank-item:nth-child(2) .rank-col-rank { color: #757575; }
        .rank-item:nth-child(3) .rank-col-rank { color: #D28C49; }

        .rank-col-profile {
            display: flex; align-items: center; gap: 12px;
            flex-grow: 1; min-width: 0;
        }
        .rank-avatar {
            width: 48px; height: 48px; font-size: 2.2em;
            flex-shrink: 0; border-radius: 12px;
            border: 3px solid var(--panel-border);
            display: flex; justify-content: center; align-items: center;
            background-color: #F8F9FA;
            overflow: hidden;
        }
        .rank-avatar img { width: 100%; height: 100%; border-radius: 8px; object-fit: contain; }
        .profile-text .nickname {
            font-size: 1.1em; font-weight: 700;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .profile-text .level { font-size: 0.85em; color: #666; font-weight: 700; }

        .rank-col-stats {
            display: flex; flex-wrap: wrap; justify-content: flex-end;
            gap: 5px;
            text-align: right;
            margin-left: 8px;
        }
        .stat-item {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: 700; white-space: nowrap;
        }
        .stat-item.wins { background-color: #E3F2FD; color: #1E88E5; border: 1px solid #BBDEFB; }
        .stat-item.losses { background-color: #FFEBEE; color: #E53935; border: 1px solid #FFCDD2; }
        .stat-item.winrate { background-color: #F3E5F5; color: #8E24AA; border: 1px solid #E1BEE7; }
        .stat-item.plays { background-color: #E8EAF6; color: #3949AB; border: 1px solid #C5CAE9; }
        .stat-item.points { background-color: #FFF8E1; color: #FF8F00; border: 1px solid #FFECB3; }

        /* ------------------------- */
        /* == í† ìŠ¤íŠ¸ ì•Œë¦¼ (ëŒ€ê¸°ì‹¤.htmlê³¼ ë™ì¼) == */
        /* ------------------------- */
        #toast-container {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 9999; display: flex; flex-direction: column;
            align-items: center; gap: 10px; pointer-events: none;
        }
        .toast-message {
            background-color: rgba(40, 40, 40, 0.85); color: white;
            padding: 10px 20px; border-radius: 20px;
            font-size: 0.9em; font-weight: 700;
            animation: toast-fade 3s ease-out forwards;
        }
        @keyframes toast-fade {
            0% { opacity: 0; transform: translateY(-10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        @keyframes toast-fade-out {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <audio id="click-sound" src="https://blog.kakaocdn.net/dna/dC0WAE/dJMb84DsZw6/AAAAAAAAAAAAAAAAAAAAAC8XpuPuNVEsdp6Ia-d35XR-m3FCZxObUR5uFI1tk2iv/%EB%B2%84%ED%8A%BC%EC%82%AC%EC%9A%B4%EB%93%9C.mp3?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1761922799&allow_ip=&allow_referer=&signature=RdbjxdP75HLHSpBIhymVkYpUOA0%3D&attach=1&knm=tfile.mp3" preload="auto"></audio>
    
    <div id="ranking-view" class="view">
        <div class="page-header">
            <a href="ëŒ€ê¸°ì‹¤.html" class="back-btn" id="back-btn">â€¹</a>
            <h1>ğŸ† ë­í‚¹</h1>
            <div style="width: 40px; flex-shrink: 0;"></div> <!-- ì˜¤ë¥¸ìª½ ì •ë ¬ìš© ë”ë¯¸ div -->
        </div>

        <!-- [ìˆ˜ì •] íƒ­ì„ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³€ê²½ -->
        <div id="ranking-select-container" style="padding: 10px 15px; background-color: #FFFAE0; border-bottom: 3px solid var(--panel-border);">
            <select id="ranking-select" style="width: 100%; padding: 12px; font-size: 1.1em; font-weight: 700; border-radius: 12px; border: 3px solid var(--text-color-dark); background-color: white; font-family: var(--font-main); -webkit-appearance: none; appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23574141%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.6-3.6%205.4-7.8%205.4-12.8%200-5-1.8-9.2-5.4-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 12px center; background-size: 12px;">
                <!-- ì˜µì…˜ì€ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì  ìƒì„± -->
            </select>
        </div>

        <div id="ranking-content">
            <div class="spinner"></div>
            <!-- ë­í‚¹ ëª©ë¡ì€ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <script src="ì•„ë°”íƒ€.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script>
        // --- í—¬í¼ í•¨ìˆ˜ (ëŒ€ê¸°ì‹¤.htmlê³¼ ë™ì¼) ---
        function showToast(message, duration = 3000) {
            const container = document.getElementById('toast-container');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'toast-fade-out 0.5s ease-out forwards';
                toast.addEventListener('animationend', () => toast.remove());
            }, duration - 500);
        }

        function escapeHTML(str) {
            if (typeof str !== 'string') return '';
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return str.replace(/[&<>"']/g, m => map[m]);
        }

        document.addEventListener('contextmenu', event => event.preventDefault());
        
        document.addEventListener('keydown', event => {
            if (event.key === 'F12' ||
                (event.ctrlKey && event.shiftKey && ['I', 'J', 'C'].includes(event.key.toUpperCase())) ||
                (event.ctrlKey && event.key.toUpperCase() === 'U')) {
            event.preventDefault();
            }
        });

        const defaultSettings = { sfx: true, bgm: true, vibration: true };
        let gameSettings = JSON.parse(localStorage.getItem('gameSettings')) || defaultSettings;

        // [ìˆ˜ì •] availableGames ë°°ì—´ (í†µí•©ëŒ€ê¸°ì‹¤.htmlì—ì„œ ë³µì‚¬)
        const availableGames = [
                        { id: 'shisenSho', name: 'ì‚¬ì²œì„±', icon: 'ğŸ€„', file: 'ì‚¬ì²œì„±.html', maxPlayers: 3, canSolo: true }, 
                       { id: 'tetris', name: 'í…ŒíŠ¸ë¦¬ìŠ¤', icon: 'ğŸ§±', file: 'í…ŒíŠ¸ë¦¬ìŠ¤.html', maxPlayers: 2, canSolo: true },
                        { id: 'alkkagi', name: 'ì•Œê¹Œê¸°', icon: 'âšª', file: 'ì•Œê¹Œê¸°.html', maxPlayers: 2, canSolo: true },
                       { id: 'candysoap', name: 'ì• ë‹ˆíŒ¡', icon: 'ğŸ¬', file: 'ì• ë‹ˆíŒ¡.html', maxPlayers: 4, canSolo: true },
                        { id: 'bomber', name: 'í¬ë ˆì´ì§€ë´„ë²„', icon: 'ğŸ•¹ï¸', file: 'ë´„ë²„ë§¨.html', maxPlayers: 4, canSolo: false },
            { id: 'quiz', name: 'AIìŠ¤í”¼ë“œí€´ì¦ˆ', icon: 'â“', file: 'aií€´ì¦ˆ.html', maxPlayers: 4, canSolo: true },
            { id: 'memoryGame', name: 'ë©”ëª¨ë¦¬', icon: 'ğŸ§ ', file: 'ë©”ëª¨ë¦¬ê²Œì„.html', maxPlayers: 4, canSolo: false },
            { id: 'reversi', name: 'ë¦¬ë²„ì‹œ', icon: 'âš«', file: 'ë¦¬ë²„ì‹œ.html', maxPlayers: 2, canSolo: true },
            { id: 'indianpoker', name: 'ì¸ë””ì–¸í¬ì»¤', icon: 'ğŸƒ', file: 'ì¸ë””ì–¸í¬ì»¤.html', maxPlayers: 2, canSolo: false },
            { id: 'linePuzzle', name: 'ë¼ì¸ í¼ì¦', icon: 'ğŸ¨', file: 'ë¼ì¸í¼ì¦.html', isSolo: true, canSolo: true }

        ];

        document.addEventListener('DOMContentLoaded', () => {
            const firebaseConfig = {
                apiKey: "AIzaSyCmNAKmgF_L3o0QyOGh_oFAq_rMRtUyklw",
                authDomain: "goodluck-7c14b.firebaseapp.com",
                databaseURL: "https://goodluck-7c14b-default-rtdb.firebaseio.com",
                projectId: "goodluck-7c14b",
                storageBucket: "goodluck-7c14b.appspot.com",
                messagingSenderId: "858281658455",
                appId: "1:858281658455:web:9131280a459be983933b12"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            const auth = firebase.auth();
            const usersRef = db.ref('users');
            
            const clickSound = document.getElementById('click-sound');
            // [ìˆ˜ì •] ë“œë¡­ë‹¤ìš´ Select
            const rankingSelect = document.getElementById('ranking-select');
            const rankingContent = document.getElementById('ranking-content');
            const backBtn = document.getElementById('back-btn');

            let currentUser, currentUserData;

            backBtn.addEventListener('click', (e) => {
                if (gameSettings.sfx) clickSound.play();
            });

            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    usersRef.child(user.uid).once('value', snapshot => {
                        if (snapshot.exists()) {
                            currentUserData = snapshot.val();
                            showRanking();
                        }
                    });
                } else {
                    window.location.replace('index.html');
                }
            });
            
            // [ìˆ˜ì •] showRanking (ë“œë¡­ë‹¤ìš´ ìš©ìœ¼ë¡œ ìˆ˜ì •)
            function showRanking() {
                rankingSelect.innerHTML = '';
                const gameTabs = [{ id: 'points', name: 'í†µí•© ë­í‚¹' }, ...availableGames.filter(g => !g.isSolo)];
                
                gameTabs.forEach((game, index) => {
                    const option = document.createElement('option');
                    option.value = game.id;
                    
                    if (game.id === 'points') {
                        option.textContent = 'ğŸ’° í†µí•© ë­í‚¹';
                    } else {
                        const gameInfo = availableGames.find(g => g.id === game.id);
                        option.textContent = gameInfo ? `${gameInfo.icon} ${game.name}` : game.name;
                    }
                    
                    rankingSelect.appendChild(option);
                });
                
                rankingSelect.onchange = () => {
                    if (gameSettings.sfx) clickSound.play();
                    loadRanking(rankingSelect.value);
                };

                loadRanking('points');
            }

            // [ìˆ˜ì •] loadRanking (í•„í„° ë¡œì§ ìˆ˜ì •)
            function loadRanking(gameId) {
                const rankingContent = document.getElementById('ranking-content');
                rankingContent.innerHTML = `<div class="spinner"></div>`;
                
                // [ì¶”ê°€] ì ìˆ˜(rating) ê¸°ë°˜ ë­í‚¹ ê²Œì„ ID ëª©ë¡
                const highscoreBasedGames = ['quiz', 'tetris']; // [ìˆ˜ì •] candysoap ì œê±°
const rankBasedGames = ['candysoap']; // [ì‹ ê·œ] candysoapëŠ” 1ìœ„ íšŸìˆ˜(rank1)ë¡œ ì •ë ¬ // [ìˆ˜ì •] í€´ì¦ˆ, í…ŒíŠ¸ë¦¬ìŠ¤, ì• ë‹ˆíŒ¡ì€ highscore ê¸°ì¤€

                usersRef.once('value', snapshot => {
                let users = [];
                snapshot.forEach(child => {
                    const user = child.val();
                    const nickname = user.profile?.nickname; // [ìˆ˜ì •] ë‹‰ë„¤ì„ ë³€ìˆ˜

                    // [ìˆ˜ì •] ë‹‰ë„¤ì„ì´ ì¡´ì¬í•˜ê³ , í…ŒìŠ¤íŠ¸ ê³„ì •ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì¶”ê°€
                    if (nickname && nickname !== 'í…ŒìŠ¤íŠ¸999' && nickname !== 'í…ŒìŠ¤íŠ¸998') {
                        users.push({ ...user, uid: child.key }); // uid ì£¼ì…
                    }
                });

                    if (gameId === 'points') {
                        // 1. í†µí•© ë­í‚¹ (í¬ì¸íŠ¸)
                        users.sort((a, b) => (b.profile.points || 0) - (a.profile.points || 0));
                    } else if (rankBasedGames.includes(gameId)) { // [ì‹ ê·œ]
                        // 2. ì• ë‹ˆíŒ¡ ë­í‚¹ (1ìœ„ íšŸìˆ˜ > 2ìœ„ íšŸìˆ˜ ìˆœ)
                        users = users.filter(user => user.gameStats?.[gameId]?.plays > 0);
                        users.sort((a, b) => {
                            const statsA = a.gameStats?.[gameId] || { rank1: 0, rank2: 0 };
                            const statsB = b.gameStats?.[gameId] || { rank1: 0, rank2: 0 };
                            
                            // 1ìˆœìœ„: 1ìœ„ íšŸìˆ˜ (ë‚´ë¦¼ì°¨ìˆœ)
                            if (statsB.rank1 !== statsA.rank1) {
                                return (statsB.rank1 || 0) - (statsA.rank1 || 0);
                            }
                            // 2ìˆœìœ„: 2ìœ„ íšŸìˆ˜ (ë‚´ë¦¼ì°¨ìˆœ)
                            return (statsB.rank2 || 0) - (statsA.rank2 || 0);
                        });
                        } else if (rankBasedGames.includes(gameId)) { // [ì‹ ê·œ]
    // 2. ì• ë‹ˆíŒ¡ ë­í‚¹ (1ìœ„ íšŸìˆ˜ > 2ìœ„ íšŸìˆ˜ ìˆœ)
    users = users.filter(user => user.gameStats?.[gameId]?.plays > 0);
    users.sort((a, b) => {
        const statsA = a.gameStats?.[gameId] || { rank1: 0, rank2: 0 };
        const statsB = b.gameStats?.[gameId] || { rank1: 0, rank2: 0 };

        // 1ìˆœìœ„: 1ìœ„ íšŸìˆ˜ (ë‚´ë¦¼ì°¨ìˆœ)
        if (statsB.rank1 !== statsA.rank1) {
            return (statsB.rank1 || 0) - (statsA.rank1 || 0);
        }
        // 2ìˆœìœ„: 2ìœ„ íšŸìˆ˜ (ë‚´ë¦¼ì°¨ìˆœ)
        return (statsB.rank2 || 0) - (statsA.rank2 || 0);
    });
} else if (highscoreBasedGames.includes(gameId)) { // [ìˆ˜ì •] highscore ê¸°ë°˜ ê²Œì„
    // 3. í€´ì¦ˆ/í…ŒíŠ¸ë¦¬ìŠ¤ ë­í‚¹ (ìµœê³ ì ìˆ˜)
    
                    } else if (highscoreBasedGames.includes(gameId)) { // [ìˆ˜ì •]
                        // 3. í€´ì¦ˆ/í…ŒíŠ¸ë¦¬ìŠ¤ ë­í‚¹ (ìµœê³ ì ìˆ˜)
                        users = users.filter(user => user.gameStats?.[gameId]?.plays > 0);
                        users.sort((a, b) => (b.gameStats?.[gameId]?.highscore || 0) - (a.gameStats?.[gameId]?.highscore || 0));
                    } else {
                        // 4. ë‚˜ë¨¸ì§€ (ìŠ¹ë¦¬) ê¸°ë°˜ ê²Œì„ ë­í‚¹
                        users = users.filter(user => user.gameStats?.[gameId]?.plays > 0);
                        users.sort((a, b) => (b.gameStats?.[gameId]?.wins || 0) - (a.gameStats?.[gameId]?.wins || 0));
                    }

                    rankingContent.innerHTML = '<div class="ranking-list"></div>';
                    const rankingList = rankingContent.querySelector('.ranking-list');

                    if (users.length === 0) {
                        rankingList.innerHTML = `<p style="text-align:center; color:#888; padding: 40px;">ë­í‚¹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                        return;
                    }

                    users.slice(0, 100).forEach((user, i) => {
                        const profile = user.profile;
                        const gameStats = user.gameStats;

                       const avatar = profile.avatar || '';
const avatarSet = AVATAR_SETS[avatar];

if (avatarSet) {
    avatarHTML = `<img src="${avatarSet.front}" alt="avatar">`;
} else if (avatar && (avatar.startsWith('http') || avatar.includes('.'))) {
    // âœ… avatar ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ì¶”ê°€
    avatarHTML = `<img src="${avatar}" alt="avatar">`;
} else {
    avatarHTML = escapeHTML(avatar || 'â“');
}
                        
                        let statsHTML = '';
                       // [ìˆ˜ì •] highscore ê¸°ë°˜ ë­í‚¹ ê²Œì„ ID ëª©ë¡
                        const highscoreBasedGames = ['quiz', 'tetris']; // [ìˆ˜ì •] candysoap ì œê±°
                        const rankBasedGames = ['candysoap']; // [ì‹ ê·œ]

                        if (gameId === 'points') {
                            const totalWins = Object.values(gameStats || {}).reduce((sum, game) => sum + (game.wins || 0), 0);
                            const totalLosses = Object.values(gameStats || {}).reduce((sum, game) => sum + (game.losses || 0), 0);
                            const totalPlays = Object.values(gameStats || {}).reduce((sum, game) => sum + (game.plays || 0), 0);
                            const totalDraws = Math.max(0, totalPlays - (totalWins + totalLosses));
                            statsHTML = `
                                <div class="stat-item wins">${totalWins}ìŠ¹</div>
                                <div class="stat-item losses">${totalLosses}íŒ¨</div>
                                <div class="stat-item plays">${totalDraws}ë¬´</div>
                                <div class="stat-item points">${(profile.points || 0).toLocaleString()} P</div>`;
                        } else if (highscoreBasedGames.includes(gameId)) { // [ìˆ˜ì •] highscore ê¸°ë°˜ ê²Œì„
                            // [ìˆ˜ì •] ì ìˆ˜ í‘œì‹œ ë¡œì§ ë¶„ë¦¬
                            const game = gameStats?.[gameId] || { wins: 0, losses: 0, draws: 0, plays: 0, highscore: 0 };
                            const highscore = game.highscore || 0;
                            const wins = game.wins || 0;
                            const losses = game.losses || 0;
                            const plays = game.plays || 0;
                            statsHTML = `
                                <div class="stat-item points">ìµœê³  ${highscore}ì </div>
                                <div class="stat-item wins">${wins}ìŠ¹</div>
                                <div class="stat-item losses">${losses}íŒ¨</div>
                                <div class="stat-item plays">${plays}íšŒ</div>`;
                        } else if (rankBasedGames.includes(gameId)) { // [ì‹ ê·œ] ì• ë‹ˆíŒ¡ ë­í‚¹ UI
                            const game = gameStats?.[gameId] || {};
                            const rank1 = game.rank1 || 0;
                            const rank2 = game.rank2 || 0;
                            const rank3 = game.rank3 || 0;
                            const rank4 = game.rank4 || 0;
                            statsHTML = `
                                <div class="stat-item" style="background-color: #FFF8E1; color: #856200; border-color: #FFECB3;">ğŸ¥‡ ${rank1}</div>
                                <div class="stat-item" style="background-color: #F5F5F5; color: #424242; border-color: #E0E0E0;">ğŸ¥ˆ ${rank2}</div>
                                <div class="stat-item" style="background-color: #FFF3E0; color: #8D5A21; border-color: #FFCC80;">ğŸ¥‰ ${rank3}</div>
                                <div class="stat-item" style="background-color: #EEEEEE; color: #616161; border-color: #E0E0E0;">${rank4}</div>
                            `;
                        } else {
                            // [ìˆ˜ì •] ì ìˆ˜ í‘œì‹œ ë¡œì§ ë¶„ë¦¬
                            const game = gameStats?.[gameId] || { wins: 0, losses: 0, draws: 0, plays: 0, rating: 0 };
                            const wins = game.wins || 0;
                            const losses = game.losses || 0;
                            const plays = game.plays || 0;
                            const draws = game.draws || 0;
                            const winRate = plays > 0 ? ((wins / plays) * 100).toFixed(0) + '%' : '0%';
                            
                            // ê¸°ë³¸ ìŠ¤íƒ¯ (ìŠ¹/íŒ¨/ë¬´/ìŠ¹ë¥ )
                            statsHTML = `
                                <div class="stat-item wins">${wins}ìŠ¹</div>
                                <div class="stat-item losses">${losses}íŒ¨</div>
                                <div class="stat-item plays">${draws}ë¬´</div> 
                                <div class="stat-item winrate">${winRate}</div>`;

                            // [ìˆ˜ì •] ì ìˆ˜(rating) ê¸°ë°˜ ê²Œì„ì¸ ê²½ìš°ì—ë§Œ ì ìˆ˜ í‘œì‹œ
                            /* [ì‚­ì œ]
                            if (ratingBasedGames.includes(gameId)) {
                                const rating = game.rating || 0;
                                statsHTML = `<div class="stat-item points">${rating}ì </div>` + statsHTML; // ì ìˆ˜ë¥¼ ë§¨ ì•ì— ì¶”ê°€
                            }
                            */
                        }
                        
                        const rankItem = document.createElement('div');
                        rankItem.className = 'rank-item';

                        if (user.uid === currentUser.uid) {
                            rankItem.classList.add('is-me');
                        }

                        rankItem.innerHTML = `
                            <div class="rank-col-rank">${i + 1}</div>
                            <div class="rank-col-profile">
                                <div class="rank-avatar">${avatarHTML}</div>
                                <div class="profile-text">
                                    <div class="nickname">${escapeHTML(profile.nickname)}</div>
                                    <div class="level">Lv. ${profile.level || 1}</div>
                                </div>
                            </div>
                            <div class="rank-col-stats">${statsHTML}</div>`;
                        rankingList.appendChild(rankItem);
                    });
                });
            }
        });
    </script>
</body>
</html>

